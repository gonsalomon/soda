from __future__ import annotations

from dataclasses import dataclass

from soda.sodacl.check_cfg import CheckCfg
from soda.sodacl.location import Location


@dataclass
class SchemaValidations:
    required_column_names: list[str] | None
    required_column_types: dict[str, str] | None
    required_column_indexes: dict[str, int] | None
    forbidden_column_names: list[str] | None
    is_column_addition_forbidden: bool
    is_column_deletion_forbidden: bool
    is_column_type_change_forbidden: bool
    is_column_index_change_forbidden: bool

    def has_change_validations(self):
        return (
            self.is_column_addition_forbidden
            or self.is_column_deletion_forbidden
            or self.is_column_type_change_forbidden
            or self.is_column_index_change_forbidden
        )


class SchemaCheckCfg(CheckCfg):
    def __init__(
        self,
        source_header: str,
        source_line: str,
        source_configurations: str | None,
        location: Location,
        name: str | None,
        warn_validations: SchemaValidations,
        fail_validations: SchemaValidations,
        schema_name: str | None = None,
        is_automated_monitoring: bool = False,
    ):
        super().__init__(source_header, source_line, source_configurations, location, name)
        self.warn_validations: SchemaValidations = warn_validations
        self.fail_validations: SchemaValidations = fail_validations
        self.is_automated_monitoring = is_automated_monitoring
        self.name = name if name else "Schema Check"
        self.schema_name = schema_name

    def has_change_validations(self) -> bool:
        return (self.warn_validations and self.warn_validations.has_change_validations()) or (
            self.fail_validations and self.fail_validations.has_change_validations()
        )
